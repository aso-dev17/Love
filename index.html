<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#07040a" />
  <title>Aso ‚ù§Ô∏è Elaf ‚Äî Romantic Final Boss</title>

  <!-- Fonts (romantic vibe) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- FX libs (no build tools) -->
  <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      --bg0:#07040a;
      --bg1:#0b0713;
      --bg2:#100a1f;

      --text:#f7f2ff;
      --muted:rgba(247,242,255,.72);

      --pink:#ff4fb4;
      --rose:#ff2e7a;
      --gold:#ffd6a6;
      --violet:#8b5cf6;
      --cyan:#22d3ee;

      --card: rgba(10, 7, 18, .64);
      --stroke: rgba(255,255,255,.10);

      --shadow: 0 30px 120px rgba(0,0,0,.65);
      --radius: 34px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      overflow:hidden;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1100px 800px at 15% 15%, rgba(255,79,180,.10), transparent 58%),
        radial-gradient(900px 650px at 85% 18%, rgba(34,211,238,.09), transparent 60%),
        radial-gradient(1000px 700px at 55% 95%, rgba(139,92,246,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 50%, var(--bg2));
    }

    /* Canvases behind everything */
    #space, #sparks{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
    }
    #space{ z-index:0; }
    #sparks{ z-index:4; }

    /* Aurora / mist */
    .aurora{
      position:fixed;
      inset:-25%;
      z-index:1;
      pointer-events:none;
      filter: blur(38px) saturate(1.12);
      opacity:.9;
      background:
        radial-gradient(40% 32% at 28% 30%, rgba(255,79,180,.25), transparent 62%),
        radial-gradient(42% 34% at 72% 28%, rgba(34,211,238,.20), transparent 62%),
        radial-gradient(38% 30% at 50% 72%, rgba(139,92,246,.22), transparent 62%),
        radial-gradient(38% 32% at 55% 55%, rgba(255,214,166,.12), transparent 65%);
      animation: auroraDrift 16s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
    }
    @keyframes auroraDrift{
      0%{ transform: translate(-2.5%, -1.5%) scale(1.04) rotate(-1.8deg); }
      50%{ transform: translate(2.2%, 1.2%) scale(1.08) rotate(1.2deg); }
      100%{ transform: translate(-1.4%, 2.6%) scale(1.05) rotate(-0.8deg); }
    }

    /* Velvet vignette */
    .vignette{
      position:fixed;
      inset:0;
      z-index:2;
      pointer-events:none;
      background:
        radial-gradient(circle at center, transparent 50%, rgba(0,0,0,.72) 100%),
        radial-gradient(800px 500px at 50% 60%, rgba(0,0,0,.18), transparent 65%);
    }

    /* Rose petals layer */
    .petals{
      position:fixed;
      inset:0;
      z-index:3;
      pointer-events:none;
      overflow:hidden;
    }
    .petal{
      position:absolute;
      width: 18px;
      height: 14px;
      opacity:.0;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.38));
      will-change: transform, opacity;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 55%),
        linear-gradient(135deg, rgba(255,79,180,.95), rgba(255,46,122,.92), rgba(139,92,246,.55));
      border-radius: 70% 30% 60% 40% / 55% 45% 55% 45%;
    }
    @keyframes fall {
      0%   { transform: translate3d(var(--x), -18vh, 0) rotate(0deg); opacity:0; }
      12%  { opacity:.9; }
      100% { transform: translate3d(calc(var(--x) + var(--dx)), 118vh, 0) rotate(var(--rot)); opacity:0; }
    }

    /* Center layout */
    .wrap{
      position:relative;
      z-index:5;
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }

    /* Animated border frame */
    .frame{
      width:min(900px, 94vw);
      border-radius: calc(var(--radius) + 12px);
      padding: 2px;
      background: conic-gradient(from 180deg,
        rgba(255,79,180,.95),
        rgba(34,211,238,.80),
        rgba(139,92,246,.95),
        rgba(255,214,166,.85),
        rgba(255,46,122,.95),
        rgba(255,79,180,.95)
      );
      box-shadow: var(--shadow);
      position:relative;
      transform-style:preserve-3d;
      animation: borderSpin 6.2s linear infinite;
    }
    @keyframes borderSpin{
      0% { filter:hue-rotate(0deg); }
      100%{ filter:hue-rotate(18deg); }
    }

    /* outer glow */
    .frame::before{
      content:"";
      position:absolute;
      inset:-18px;
      border-radius: inherit;
      background:
        radial-gradient(35% 35% at 28% 20%, rgba(255,79,180,.22), transparent 62%),
        radial-gradient(35% 35% at 72% 25%, rgba(34,211,238,.16), transparent 62%),
        radial-gradient(35% 35% at 50% 82%, rgba(139,92,246,.16), transparent 62%);
      filter: blur(26px);
      opacity:.95;
      z-index:-1;
      pointer-events:none;
    }

    /* Card */
    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(10, 7, 18, .70), rgba(6, 4, 10, .62));
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(14px);
      overflow:hidden;
      transform-style:preserve-3d;
    }

    .top{
      padding: 20px 24px 16px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(247,242,255,.76);
      font-size:13px;
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:9px;height:9px;border-radius:50%;
      background: linear-gradient(135deg, var(--pink), var(--cyan));
      box-shadow: 0 0 18px rgba(255,79,180,.45), 0 0 26px rgba(34,211,238,.20);
    }

    .hint{
      color: rgba(247,242,255,.72);
      font-size:13px;
      user-select:none;
    }

    .body{
      padding: 30px 24px 18px;
      display:grid;
      gap: 18px;
      text-align:center;
    }

    /* Script headline + shimmer */
    .script{
      font-family: "Great Vibes", cursive;
      font-size: clamp(44px, 7.5vw, 88px);
      line-height: .98;
      margin: 0;
      letter-spacing: 0.01em;
      transform: translateZ(26px);
      text-shadow:
        0 12px 40px rgba(0,0,0,.45),
        0 0 30px rgba(255,79,180,.16),
        0 0 40px rgba(34,211,238,.10);
      position:relative;
      display:inline-block;
      padding: 0 .12em;
    }
    .script::after{
      content:"";
      position:absolute;
      inset:-6px -10px;
      background: linear-gradient(90deg,
        transparent,
        rgba(255,255,255,.20),
        rgba(255,214,166,.14),
        transparent
      );
      transform: skewX(-18deg);
      opacity:.0;
      animation: glint 3.8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes glint{
      0%, 60% { opacity:0; transform: translateX(-20%) skewX(-18deg); }
      70% { opacity:.75; }
      100% { opacity:0; transform: translateX(120%) skewX(-18deg); }
    }

    .titleGlow{
      background: linear-gradient(90deg,
        rgba(247,242,255,.95),
        rgba(255,214,166,.92),
        rgba(255,79,180,.95),
        rgba(34,211,238,.90),
        rgba(139,92,246,.92),
        rgba(247,242,255,.95)
      );
      background-size: 240% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      animation: shimmer 3.2s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
      100%{ background-position: 0% 50%; }
    }

    .sub{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.65;
      transform: translateZ(18px);
    }

    /* Love Reactor */
    .reactorWrap{
      display:grid;
      place-items:center;
      margin-top: 2px;
      transform: translateZ(34px);
    }

    .reactor{
      width: 122px;
      height: 122px;
      border-radius: 30px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:
        0 0 40px rgba(255,79,180,.18),
        0 0 55px rgba(34,211,238,.10),
        0 18px 60px rgba(0,0,0,.45);
      display:grid;
      place-items:center;
      cursor:pointer;
      touch-action: manipulation;
      position:relative;
      overflow:hidden;
      outline:none;
      transition: transform .12s ease;
    }
    .reactor:hover{ transform: translateY(-1px) scale(1.01); }
    .reactor:active{ transform: translateY(0) scale(.99); }
    .reactor:focus-visible{
      box-shadow:
        0 0 40px rgba(255,79,180,.22),
        0 0 55px rgba(34,211,238,.14),
        0 0 0 3px rgba(34,211,238,.22);
    }

    /* glossy sweep */
    .reactor::before{
      content:"";
      position:absolute;
      inset:-60%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 48%),
        linear-gradient(135deg, rgba(255,255,255,.10), transparent 60%);
      transform: rotate(22deg);
      opacity:.95;
      pointer-events:none;
    }

    /* outer ring (animated) */
    .ring{
      position:absolute;
      inset:-22px;
      border-radius: 40px;
      background: conic-gradient(from 180deg,
        rgba(255,79,180,.0),
        rgba(255,79,180,.35),
        rgba(34,211,238,.25),
        rgba(139,92,246,.28),
        rgba(255,214,166,.25),
        rgba(255,79,180,.0)
      );
      filter: blur(0.2px);
      opacity:.85;
      animation: spin 5.2s linear infinite;
      pointer-events:none;
    }
    .ring::after{
      content:"";
      position:absolute;
      inset: 3px;
      border-radius: 38px;
      background: rgba(10, 7, 18, .75);
      border: 1px solid rgba(255,255,255,.10);
    }
    @keyframes spin{
      to{ transform: rotate(360deg); }
    }

    /* inner heart */
    .heart{
      width: 64px;
      height: 64px;
      position:relative;
      transform: rotate(45deg);
      background: linear-gradient(135deg, var(--pink), var(--violet));
      border-radius: 18px;
      box-shadow:
        0 10px 34px rgba(0,0,0,.42),
        0 0 26px rgba(255,79,180,.30);
      animation: beat 1.45s ease-in-out infinite;
      z-index:2;
    }
    .heart::before,
    .heart::after{
      content:"";
      position:absolute;
      width: 64px;
      height: 64px;
      background: inherit;
      border-radius: 50%;
    }
    .heart::before{ left:-32px; top:0; }
    .heart::after{ top:-32px; left:0; }

    @keyframes beat{
      0%,100% { transform: rotate(45deg) scale(1); filter:saturate(1.06); }
      50%     { transform: rotate(45deg) scale(1.16); filter:saturate(1.22); }
    }

    /* orbiting icons */
    .orbits{
      position:relative;
      width: 190px;
      height: 190px;
      margin-top: 12px;
      transform: translateZ(16px);
      pointer-events:none;
      opacity:.9;
    }
    .orbit{
      position:absolute;
      inset:0;
      border-radius: 999px;
      border:1px dashed rgba(255,255,255,.10);
      filter: drop-shadow(0 0 12px rgba(255,79,180,.10));
    }
    .orbit.o2{ inset: 14px; opacity:.7; }
    .orbit.o3{ inset: 30px; opacity:.55; }

    .sat{
      position:absolute;
      left:50%;
      top:50%;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 26px rgba(0,0,0,.28);
      transform: translate(-50%,-50%);
      font-size: 14px;
    }

    /* actions */
    .actions{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 8px;
      transform: translateZ(16px);
    }
    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(247,242,255,.94);
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
      touch-action: manipulation;
    }
    button:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.18);
    }
    button:active{ transform: translateY(0); }

    .primary{
      background: linear-gradient(135deg, rgba(255,79,180,.22), rgba(34,211,238,.14));
      border-color: rgba(255,79,180,.26);
    }

    .footer{
      padding: 16px 22px 18px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex;
      justify-content:space-between;
      gap:12px;
      color: rgba(247,242,255,.62);
      font-size: 12px;
      user-select:none;
    }
    .kbd{
      padding:4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(247,242,255,.86);
    }

    /* Ripple element */
    .ripple{
      position:fixed;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(255,79,180,.55);
      box-shadow: 0 0 22px rgba(255,79,180,.18), 0 0 28px rgba(34,211,238,.12);
      pointer-events:none;
      z-index: 9999;
      transform: translate(-50%, -50%) scale(0);
      opacity: .9;
      animation: ripple 860ms ease-out forwards;
    }
    @keyframes ripple{
      0%{ transform: translate(-50%,-50%) scale(0); opacity:.85; }
      100%{ transform: translate(-50%,-50%) scale(13); opacity:0; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .aurora{ animation:none; }
      .frame{ animation:none; }
      .titleGlow{ animation:none; }
      .script::after{ animation:none; }
      .ring{ animation:none; }
      .heart{ animation:none; }
    }

    @media (max-width: 420px){
      .top{ flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>

<body>
  <canvas id="space" aria-hidden="true"></canvas>
  <div class="aurora" aria-hidden="true"></div>
  <div class="petals" id="petals" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>
  <canvas id="sparks" aria-hidden="true"></canvas>

  <main class="wrap">
    <div class="frame" id="frame">
      <section class="card" id="card" role="region" aria-label="Aso and Elaf romantic card">
        <header class="top">
          <div class="pill">
            <span class="dot"></span>
            <span>Romantic Final Boss Mode</span>
          </div>
          <div class="hint">Tap anywhere ‚ú® (Press <b>H</b>)</div>
        </header>

        <div class="body">
          <h1 class="script">
            <span class="titleGlow">Aso ‚ù§Ô∏è Elaf</span>
          </h1>

          <div class="reactorWrap">
            <div class="reactor" id="reactor" role="button" tabindex="0" aria-label="Love Reactor">
              <div class="ring" aria-hidden="true"></div>
              <div class="heart" aria-hidden="true"></div>
            </div>

            <div class="orbits" aria-hidden="true">
              <div class="orbit o1"></div>
              <div class="orbit o2"></div>
              <div class="orbit o3"></div>

              <div class="sat" id="sat1">üíû</div>
              <div class="sat" id="sat2">‚ú®</div>
              <div class="sat" id="sat3">üåô</div>
              <div class="sat" id="sat4">üíò</div>
            </div>
          </div>

          <p class="sub">
            A velvet-night universe where the only truth is:
            <strong>Aso ‚ù§Ô∏è Elaf</strong> <br/>
            Tap the Love Reactor and watch romance explode into stars üíó
          </p>

          <div class="actions">
            <button class="primary" id="btnSummon" type="button">Summon Romance</button>
            <button id="btnPetals" type="button" aria-pressed="true">Petals: ON</button>
            <button id="btnUltra" type="button" aria-pressed="true">Ultra FX: ON</button>
          </div>
        </div>

        <footer class="footer">
          <span>Made with üíó in the night sky</span>
          <span class="kbd">Tip: click + drag (tilt)</span>
        </footer>
      </section>
    </div>
  </main>

  <script>
    // =========================
    // Helpers
    // =========================
    const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    const rand = (a,b)=>a+Math.random()*(b-a);
    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    // =========================
    // 3D Tilt
    // =========================
    const frame = document.getElementById("frame");
    let ultraFX = !prefersReduced;

    let lastMove = 0;
    window.addEventListener("pointermove", (e)=>{
      if(!ultraFX) return;
      const now = performance.now();
      if(now - lastMove < 12) return;
      lastMove = now;

      const r = frame.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const dx = (e.clientX - cx) / r.width;
      const dy = (e.clientY - cy) / r.height;
      const max = 10;

      frame.style.transform = `rotateX(${(-dy*max).toFixed(2)}deg) rotateY(${(dx*max).toFixed(2)}deg)`;
    });
    window.addEventListener("pointerleave", ()=> frame.style.transform = "rotateX(0deg) rotateY(0deg)");
    window.addEventListener("blur", ()=> frame.style.transform = "rotateX(0deg) rotateY(0deg)");

    // =========================
    // Orbiting sats animation
    // =========================
    const sats = [
      { el: document.getElementById("sat1"), r: 86, s: 0.0017, p: rand(0,Math.PI*2) },
      { el: document.getElementById("sat2"), r: 70, s: 0.0022, p: rand(0,Math.PI*2) },
      { el: document.getElementById("sat3"), r: 56, s: 0.0029, p: rand(0,Math.PI*2) },
      { el: document.getElementById("sat4"), r: 92, s: 0.00135,p: rand(0,Math.PI*2) },
    ];

    function orbitTick(t){
      const box = document.querySelector(".orbits").getBoundingClientRect();
      const cx = box.width/2, cy = box.height/2;
      for(const o of sats){
        o.p += o.s * (ultraFX ? 1 : 0.5) * 16;
        const x = cx + Math.cos(o.p) * o.r;
        const y = cy + Math.sin(o.p) * o.r;
        o.el.style.transform = `translate(${x}px, ${y}px) translate(-50%,-50%)`;
      }
      requestAnimationFrame(orbitTick);
    }
    requestAnimationFrame(orbitTick);

    // =========================
    // Space canvas (stars + soft nebula)
    // =========================
    const space = document.getElementById("space");
    const sctx = space.getContext("2d", { alpha:true });

    let W=0,H=0,DPR=Math.min(devicePixelRatio||1,2);
    function resizeSpace(){
      W=innerWidth; H=innerHeight;
      DPR=Math.min(devicePixelRatio||1,2);
      space.width=Math.floor(W*DPR);
      space.height=Math.floor(H*DPR);
      space.style.width=W+"px";
      space.style.height=H+"px";
      sctx.setTransform(DPR,0,0,DPR,0,0);
    }
    addEventListener("resize", resizeSpace);
    resizeSpace();

    const stars = Array.from({length: 220}, ()=>({
      x: Math.random()*W,
      y: Math.random()*H,
      r: rand(0.6, 2.2),
      a: rand(0.05, 0.75),
      tw: rand(0.002, 0.012),
      sp: rand(0.03, 0.22)
    }));

    let mx=0,my=0;
    addEventListener("pointermove",(e)=>{
      mx = (e.clientX/W - 0.5)*2;
      my = (e.clientY/H - 0.5)*2;
    });

    function drawNebula(){
      if(!ultraFX) return;
      // very soft colorful fog blobs
      const blobs = [
        {x: W*0.2, y:H*0.25, c:"rgba(255,79,180,.06)"},
        {x: W*0.8, y:H*0.22, c:"rgba(34,211,238,.05)"},
        {x: W*0.55,y:H*0.82, c:"rgba(139,92,246,.06)"},
        {x: W*0.45,y:H*0.50, c:"rgba(255,214,166,.03)"},
      ];
      for(const b of blobs){
        const g = sctx.createRadialGradient(b.x,b.y,0,b.x,b.y,Math.min(W,H)*0.55);
        g.addColorStop(0,b.c);
        g.addColorStop(1,"rgba(0,0,0,0)");
        sctx.fillStyle = g;
        sctx.fillRect(0,0,W,H);
      }
    }

    function drawStars(){
      sctx.clearRect(0,0,W,H);
      drawNebula();

      for(const st of stars){
        st.a += (Math.random()<0.5 ? -1 : 1) * st.tw;
        st.a = clamp(st.a, 0.06, 0.78);

        st.x += st.sp * (ultraFX ? 1 : 0.6);
        if(st.x > W + 20) st.x = -20;

        const px = st.x + mx*10;
        const py = st.y + my*8;

        sctx.beginPath();
        sctx.arc(px, py, st.r, 0, Math.PI*2);
        sctx.fillStyle = `rgba(255,255,255,${st.a})`;
        sctx.fill();

        // occasional glow
        if(ultraFX && st.r > 1.7 && Math.random()<0.01){
          sctx.beginPath();
          sctx.arc(px, py, st.r*5.5, 0, Math.PI*2);
          sctx.fillStyle = `rgba(255,79,180,${st.a*0.08})`;
          sctx.fill();
        }
      }
    }

    // =========================
    // Sparks canvas (tap trails)
    // =========================
    const sparksC = document.getElementById("sparks");
    const pctx = sparksC.getContext("2d", { alpha:true });
    let PW=0,PH=0;
    function resizeSparks(){
      PW=innerWidth; PH=innerHeight;
      sparksC.width=Math.floor(PW*DPR);
      sparksC.height=Math.floor(PH*DPR);
      sparksC.style.width=PW+"px";
      sparksC.style.height=PH+"px";
      pctx.setTransform(DPR,0,0,DPR,0,0);
    }
    addEventListener("resize", resizeSparks);
    resizeSparks();

    const sparkList = [];
    function addSparks(x,y, power=1){
      if(!ultraFX) return;
      const n = Math.floor(10 * power);
      for(let i=0;i<n;i++){
        sparkList.push({
          x,y,
          vx: (Math.random()-0.5)*3.6*power,
          vy: (Math.random()-0.85)*4.2*power,
          life: 1,
          r: rand(1.0, 2.6)
        });
      }
    }
    function drawSparks(){
      pctx.clearRect(0,0,PW,PH);
      if(!ultraFX) return;

      for(let i=sparkList.length-1;i>=0;i--){
        const s = sparkList[i];
        s.x += s.vx;
        s.y += s.vy;
        s.vx *= 0.98;
        s.vy *= 0.98;
        s.life -= 0.02;

        if(s.life <= 0){ sparkList.splice(i,1); continue; }

        const a = s.life * 0.75;
        const g = pctx.createRadialGradient(s.x,s.y,0,s.x,s.y,14);
        g.addColorStop(0, `rgba(255,79,180,${a})`);
        g.addColorStop(0.55, `rgba(34,211,238,${a*0.55})`);
        g.addColorStop(1, "rgba(0,0,0,0)");

        pctx.fillStyle = g;
        pctx.beginPath();
        pctx.arc(s.x, s.y, 10 + s.r*2, 0, Math.PI*2);
        pctx.fill();
      }
    }

    // =========================
    // Petals generator
    // =========================
    const petalsEl = document.getElementById("petals");
    let petalsOn = true;

    function spawnPetal(){
      if(!petalsOn) return;
      const el = document.createElement("div");
      el.className = "petal";
      const x = rand(0, 100);
      const dx = rand(-20, 20);
      const rot = rand(120, 540);
      const dur = rand(6, 11);
      const delay = rand(0, 2.2);

      el.style.setProperty("--x", x + "vw");
      el.style.setProperty("--dx", dx + "vw");
      el.style.setProperty("--rot", rot + "deg");
      el.style.left = x + "vw";
      el.style.animation = `fall ${dur}s linear ${delay}s forwards`;
      el.style.opacity = "0";

      // random scale / blur
      const scale = rand(0.75, 1.35);
      el.style.transform = `scale(${scale})`;
      el.style.filter = `drop-shadow(0 10px 18px rgba(0,0,0,.38)) blur(${rand(0, 0.25)}px)`;

      petalsEl.appendChild(el);
      el.addEventListener("animationend", ()=> el.remove());
    }

    // keep petals flowing
    setInterval(()=> {
      if(prefersReduced) return;
      if(!petalsOn) return;
      spawnPetal();
      if(Math.random() < 0.6) spawnPetal();
    }, 520);

    // =========================
    // Ripple + Confetti Heart Burst
    // =========================
    function rippleAt(x,y){
      const r = document.createElement("div");
      r.className = "ripple";
      r.style.left = x + "px";
      r.style.top  = y + "px";
      document.body.appendChild(r);
      r.addEventListener("animationend", ()=> r.remove());
    }

    function heartBurst(x,y, intensity=1){
      if(typeof confetti !== "function") return;

      const origin = { x: x/innerWidth, y: y/innerHeight };
      let heartShape = null;

      try{
        if(confetti.shapeFromText){
          heartShape = confetti.shapeFromText({ text:"üíñ", scalar: 1.2 });
        }
      }catch{}

      const colors = ["#ff4fb4","#ff2e7a","#8b5cf6","#22d3ee","#ffd6a6","#ffffff"];

      confetti({
        origin,
        particleCount: Math.floor(90 * intensity),
        spread: 80,
        startVelocity: 38,
        gravity: 1.05,
        ticks: 240,
        scalar: 1.05,
        colors,
        shapes: heartShape ? [heartShape] : ["circle"]
      });

      confetti({
        origin,
        particleCount: Math.floor(44 * intensity),
        spread: 120,
        startVelocity: 28,
        gravity: 1.2,
        ticks: 220,
        scalar: 0.85,
        colors: ["#ffffff","#22d3ee","#ff4fb4"],
        shapes: ["circle"]
      });
    }

    function magicAt(x,y, power=1){
      rippleAt(x,y);
      addSparks(x,y, power);
      if(!prefersReduced) heartBurst(x,y, power);
    }

    // =========================
    // Reactor interaction
    // =========================
    const reactor = document.getElementById("reactor");
    function reactorFire(){
      const r = reactor.getBoundingClientRect();
      const x = r.left + r.width/2;
      const y = r.top + r.height/2;
      magicAt(x,y, 1.35);
      if(typeof gsap !== "undefined" && !prefersReduced){
        gsap.fromTo("#frame", { scale:1 }, { scale:1.01, yoyo:true, repeat:1, duration:0.12, ease:"power2.out" });
      }
    }
    reactor.addEventListener("click", reactorFire);
    reactor.addEventListener("keydown",(e)=>{
      if(e.key==="Enter" || e.key===" "){ e.preventDefault(); reactorFire(); }
    });

    // click anywhere (except buttons)
    window.addEventListener("pointerdown",(e)=>{
      const tag = (e.target?.tagName || "").toLowerCase();
      if(tag === "button") return;
      magicAt(e.clientX, e.clientY, 1);
    });

    // keyboard shortcut
    window.addEventListener("keydown",(e)=>{
      if(e.key.toLowerCase()==="h"){
        magicAt(rand(80, innerWidth-80), rand(120, innerHeight-220), 1.05);
      }
    });

    // Buttons
    document.getElementById("btnSummon").addEventListener("click", ()=>{
      magicAt(innerWidth/2, innerHeight/2 - 60, 1.5);
      // mini chain burst
      if(!prefersReduced){
        setTimeout(()=>magicAt(innerWidth/2 - 140, innerHeight/2 - 10, 1.15), 160);
        setTimeout(()=>magicAt(innerWidth/2 + 160, innerHeight/2 - 10, 1.15), 260);
      }
    });

    const btnPetals = document.getElementById("btnPetals");
    btnPetals.addEventListener("click", ()=>{
      petalsOn = !petalsOn;
      btnPetals.textContent = petalsOn ? "Petals: ON" : "Petals: OFF";
      btnPetals.setAttribute("aria-pressed", petalsOn ? "true" : "false");
      if(!petalsOn) petalsEl.innerHTML = "";
    });

    const btnUltra = document.getElementById("btnUltra");
    btnUltra.addEventListener("click", ()=>{
      ultraFX = !ultraFX;
      btnUltra.textContent = ultraFX ? "Ultra FX: ON" : "Ultra FX: OFF";
      btnUltra.setAttribute("aria-pressed", ultraFX ? "true" : "false");
      if(!ultraFX){
        // reset tilt + clear sparks
        frame.style.transform = "rotateX(0deg) rotateY(0deg)";
        sparkList.length = 0;
      }
    });

    // =========================
    // Main loop
    // =========================
    function tick(){
      drawStars();
      drawSparks();
      requestAnimationFrame(tick);
    }
    tick();

    // =========================
    // Cinematic entrance
    // =========================
    window.addEventListener("load", ()=>{
      if(typeof gsap !== "undefined"){
        const tl = gsap.timeline({ defaults:{ ease:"power3.out" } });
        tl.fromTo("#frame",{ opacity:0, y:30, scale:0.96 },{ opacity:1, y:0, scale:1, duration:0.9 })
          .fromTo(".pill",{ opacity:0, x:-10 },{ opacity:1, x:0, duration:0.45 }, "-=0.45")
          .fromTo(".hint",{ opacity:0, x:10 },{ opacity:1, x:0, duration:0.45 }, "<")
          .fromTo(".script",{ opacity:0, y:10 },{ opacity:1, y:0, duration:0.6 }, "-=0.15")
          .fromTo("#reactor",{ opacity:0, scale:0.85 },{ opacity:1, scale:1, duration:0.55 }, "-=0.2")
          .fromTo(".sub",{ opacity:0, y:10 },{ opacity:1, y:0, duration:0.5 }, "-=0.25")
          .fromTo(".actions button",{ opacity:0, y:10 },{ opacity:1, y:0, duration:0.45, stagger:0.08 }, "-=0.25");

        if(!prefersReduced){
          gsap.to(".frame", { filter:"drop-shadow(0 0 24px rgba(255,79,180,.12)) drop-shadow(0 0 30px rgba(34,211,238,.08))",
            duration:2.2, yoyo:true, repeat:-1, ease:"sine.inOut" });
        }
      }

      // first romance blast
      setTimeout(()=> magicAt(innerWidth/2, innerHeight/2 - 90, 1.25), 520);
    });
  </script>
</body>
</html>
