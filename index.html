<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#07050a" />
  <title>Aso ‚ù§Ô∏è Elaf ‚Äî Love Letter</title>

  <!-- Romantic calligraphy + clean UI font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#07050a;
      --bg1:#0b0714;
      --bg2:#130a22;

      --text:#f7f3ff;
      --muted:rgba(247,243,255,.72);

      --rose:#ff2e7a;
      --pink:#ff4fb4;
      --violet:#8b5cf6;
      --cyan:#22d3ee;
      --gold:#ffd7a8;

      --shadow: 0 30px 120px rgba(0,0,0,.65);
      --stroke: rgba(255,255,255,.10);
      --radius: 28px;

      --paper:#f6f1e6;
      --paper2:#f3ecdc;
      --ink:#24152e;
      --ink2: rgba(36,21,46,.78);
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      overflow:hidden;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1100px 800px at 18% 18%, rgba(255,79,180,.10), transparent 58%),
        radial-gradient(900px 650px at 82% 18%, rgba(34,211,238,.08), transparent 60%),
        radial-gradient(1000px 700px at 55% 95%, rgba(139,92,246,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg2));
    }

    /* FX canvases */
    #fx{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:0;
    }

    /* Soft aurora mist */
    .mist{
      position:fixed;
      inset:-25%;
      z-index:1;
      pointer-events:none;
      filter: blur(40px) saturate(1.1);
      opacity:.9;
      background:
        radial-gradient(40% 32% at 28% 30%, rgba(255,79,180,.24), transparent 62%),
        radial-gradient(42% 34% at 72% 28%, rgba(34,211,238,.18), transparent 62%),
        radial-gradient(38% 30% at 50% 72%, rgba(139,92,246,.22), transparent 62%),
        radial-gradient(38% 32% at 52% 58%, rgba(255,215,168,.10), transparent 64%);
      animation: drift 16s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      0%{ transform: translate(-2.5%, -1.5%) scale(1.04) rotate(-1.6deg); }
      50%{ transform: translate(2.2%, 1.2%) scale(1.08) rotate(1.1deg); }
      100%{ transform: translate(-1.4%, 2.6%) scale(1.05) rotate(-0.8deg); }
    }

    /* Vignette */
    .vignette{
      position:fixed;
      inset:0;
      z-index:2;
      pointer-events:none;
      background: radial-gradient(circle at center, transparent 52%, rgba(0,0,0,.72) 100%);
    }

    .wrap{
      position:relative;
      z-index:3;
      height:100%;
      display:grid;
      place-items:center;
      padding:22px;
    }

    /* Header mini label */
    .topbar{
      position:fixed;
      top:16px;
      left:50%;
      transform: translateX(-50%);
      z-index:4;
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(247,243,255,.78);
      font-size:13px;
      user-select:none;
      backdrop-filter: blur(12px);
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
    }
    .topdot{
      width:9px;height:9px;border-radius:50%;
      background: linear-gradient(135deg, var(--pink), var(--cyan));
      box-shadow: 0 0 18px rgba(255,79,180,.40), 0 0 26px rgba(34,211,238,.18);
    }

    /* Stage (for parallax tilt) */
    .stage{
      width:min(940px, 96vw);
      display:grid;
      place-items:center;
      perspective: 1000px;
    }

    /* Envelope shell */
    .envelope{
      width:min(620px, 92vw);
      aspect-ratio: 16 / 11;
      position:relative;
      transform-style:preserve-3d;
      will-change: transform;
    }

    /* Outer frame glow */
    .frame{
      position:absolute;
      inset:-10px;
      border-radius: calc(var(--radius) + 12px);
      background: conic-gradient(from 180deg,
        rgba(255,79,180,.95),
        rgba(34,211,238,.75),
        rgba(139,92,246,.95),
        rgba(255,215,168,.80),
        rgba(255,46,122,.95),
        rgba(255,79,180,.95)
      );
      filter: blur(0.3px);
      opacity:.9;
      z-index:-1;
    }
    .frame::before{
      content:"";
      position:absolute;
      inset:-20px;
      border-radius: inherit;
      background:
        radial-gradient(35% 35% at 28% 20%, rgba(255,79,180,.20), transparent 62%),
        radial-gradient(35% 35% at 72% 25%, rgba(34,211,238,.14), transparent 62%),
        radial-gradient(35% 35% at 50% 82%, rgba(139,92,246,.14), transparent 62%);
      filter: blur(26px);
      opacity:.95;
      z-index:-2;
    }

    /* Envelope base */
    .env-body{
      position:absolute;
      inset:0;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(12,10,22,.70), rgba(7,6,12,.64));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }

    /* subtle texture */
    .env-body::after{
      content:"";
      position:absolute;
      inset:0;
      opacity:.18;
      background:
        radial-gradient(800px 500px at 30% 20%, rgba(255,255,255,.10), transparent 65%),
        radial-gradient(700px 500px at 70% 70%, rgba(255,255,255,.08), transparent 70%),
        repeating-linear-gradient(45deg, rgba(255,255,255,.04), rgba(255,255,255,.04) 2px, transparent 2px, transparent 10px);
      mix-blend-mode: overlay;
      pointer-events:none;
    }

    /* Envelope front triangle */
    .env-front{
      position:absolute;
      left:0; right:0;
      bottom:0;
      height:62%;
      clip-path: polygon(0 100%, 50% 40%, 100% 100%, 100% 100%, 0 100%);
      background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-top:1px solid rgba(255,255,255,.10);
      z-index:4;
      pointer-events:none;
    }

    /* Left + right folds */
    .env-left, .env-right{
      position:absolute;
      bottom:0;
      width:55%;
      height:70%;
      background: rgba(255,255,255,.04);
      z-index:3;
      pointer-events:none;
    }
    .env-left{
      left:0;
      clip-path: polygon(0 100%, 100% 55%, 100% 100%);
      border-right:1px solid rgba(255,255,255,.08);
    }
    .env-right{
      right:0;
      clip-path: polygon(0 55%, 100% 100%, 0 100%);
      border-left:1px solid rgba(255,255,255,.08);
    }

    /* Flap (opens) */
    .env-flap{
      position:absolute;
      top:0; left:0; right:0;
      height:56%;
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform 900ms cubic-bezier(.2,.9,.15,1);
      z-index:5;
      pointer-events:none;
    }
    .env-flap::before{
      content:"";
      position:absolute; inset:0;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      border-bottom:1px solid rgba(255,255,255,.10);
    }

    /* Wax seal (button) */
    .seal{
      position:absolute;
      left:50%;
      top:52%;
      transform: translate(-50%, -50%);
      width: 90px;
      height: 90px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.25), transparent 50%),
        radial-gradient(circle at 60% 70%, rgba(0,0,0,.25), transparent 55%),
        linear-gradient(135deg, rgba(255,46,122,.95), rgba(255,79,180,.92), rgba(139,92,246,.55));
      box-shadow:
        0 22px 60px rgba(0,0,0,.45),
        0 0 34px rgba(255,79,180,.18),
        0 0 26px rgba(34,211,238,.10);
      cursor:pointer;
      display:grid;
      place-items:center;
      z-index:6;
      outline:none;
      touch-action: manipulation;
      transition: transform 160ms ease, filter 160ms ease;
      user-select:none;
    }
    .seal:hover{ transform: translate(-50%,-50%) scale(1.02); }
    .seal:active{ transform: translate(-50%,-50%) scale(.99); }
    .seal:focus-visible{
      box-shadow:
        0 22px 60px rgba(0,0,0,.45),
        0 0 0 4px rgba(34,211,238,.18),
        0 0 34px rgba(255,79,180,.18);
    }
    .seal span{
      font-size: 28px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
    }
    .seal small{
      position:absolute;
      bottom:-18px;
      left:50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: rgba(247,243,255,.70);
      white-space:nowrap;
      opacity:.85;
    }

    /* Letter (slides out) */
    .letter{
      position:absolute;
      left:50%;
      bottom: 10%;
      transform: translateX(-50%) translateY(32%) translateZ(1px);
      width: 86%;
      height: 82%;
      border-radius: 22px;
      z-index:2;
      transition: transform 980ms cubic-bezier(.2,.95,.15,1);
      pointer-events:none; /* becomes interactive when open */
    }

    .paper{
      width:100%;
      height:100%;
      border-radius: 22px;
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(255,255,255,.70), transparent 65%),
        radial-gradient(800px 520px at 80% 40%, rgba(255,255,255,.55), transparent 70%),
        linear-gradient(180deg, var(--paper), var(--paper2));
      color: var(--ink);
      box-shadow: 0 26px 90px rgba(0,0,0,.55);
      border: 1px solid rgba(0,0,0,.10);
      overflow:hidden;
      position:relative;
      padding: 26px 22px;
    }

    /* paper grain */
    .paper::after{
      content:"";
      position:absolute;
      inset:0;
      opacity:.16;
      background:
        repeating-linear-gradient(0deg, rgba(0,0,0,.05), rgba(0,0,0,.05) 1px, transparent 1px, transparent 7px),
        radial-gradient(600px 420px at 50% 20%, rgba(0,0,0,.06), transparent 65%);
      mix-blend-mode:multiply;
      pointer-events:none;
    }

    /* header calligraphy */
    .calligraphy{
      margin: 0;
      font-family: "Great Vibes", cursive;
      font-size: clamp(46px, 6.8vw, 78px);
      line-height: .95;
      letter-spacing: .01em;
      position:relative;
      z-index:1;
      text-align:center;
      color: transparent;
      background: linear-gradient(90deg,
        rgba(36,21,46,1),
        rgba(255,46,122,.95),
        rgba(139,92,246,.85),
        rgba(34,211,238,.70),
        rgba(36,21,46,1)
      );
      background-size: 240% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      animation: inkShine 3.2s ease-in-out infinite;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.10));
      user-select:none;
    }
    @keyframes inkShine{
      0%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
      100%{ background-position: 0% 50%; }
    }

    .divider{
      margin: 14px auto 14px;
      width:min(320px, 70%);
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, rgba(255,46,122,.35), rgba(34,211,238,.28), transparent);
      filter: blur(.2px);
      opacity:.85;
      position:relative;
      z-index:1;
    }

    .type{
      margin: 0;
      font-size: 14px;
      line-height: 1.75;
      color: var(--ink2);
      text-align:center;
      position:relative;
      z-index:1;
      min-height: 4.8em;
    }

    .cursor{
      display:inline-block;
      width: 10px;
      height: 1.05em;
      transform: translateY(3px);
      margin-left: 4px;
      background: rgba(255,46,122,.55);
      border-radius: 2px;
      animation: blink 1s steps(2,end) infinite;
    }
    @keyframes blink{ 50%{ opacity:.08; } }

    .sig{
      margin-top: 12px;
      text-align:center;
      font-weight:800;
      letter-spacing:.05em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(36,21,46,.55);
      position:relative;
      z-index:1;
      user-select:none;
    }

    /* Mini controls inside letter */
    .mini{
      margin-top: 16px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      position:relative;
      z-index:1;
      pointer-events:auto;
    }
    .btn{
      appearance:none;
      border: 1px solid rgba(36,21,46,.18);
      background: rgba(255,255,255,.65);
      color: rgba(36,21,46,.86);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.78); }
    .btn:active{ transform: translateY(0); }
    .btn.primary{
      border-color: rgba(255,46,122,.26);
      background: linear-gradient(135deg, rgba(255,46,122,.14), rgba(34,211,238,.10));
    }

    /* Open state */
    .open .env-flap{ transform: rotateX(175deg); }
    .open .letter{
      transform: translateX(-50%) translateY(-8%) translateZ(1px);
      pointer-events:auto;
    }
    .open .seal small{ opacity:.0; }

    /* Footer hint */
    .foot{
      position:fixed;
      bottom:16px;
      left:50%;
      transform: translateX(-50%);
      z-index:4;
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(247,243,255,.74);
      font-size:12px;
      user-select:none;
      backdrop-filter: blur(12px);
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
    }
    .kbd{
      padding:4px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(247,243,255,.88);
      font-weight:800;
    }

    /* Ripple */
    .ripple{
      position:fixed;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(255,46,122,.55);
      box-shadow: 0 0 22px rgba(255,46,122,.18), 0 0 28px rgba(34,211,238,.12);
      pointer-events:none;
      z-index: 9999;
      transform: translate(-50%, -50%) scale(0);
      opacity: .9;
      animation: ripple 860ms ease-out forwards;
    }
    @keyframes ripple{
      0%{ transform: translate(-50%,-50%) scale(0); opacity:.85; }
      100%{ transform: translate(-50%,-50%) scale(13); opacity:0; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .mist{ animation:none; }
      .calligraphy{ animation:none; }
      .cursor{ animation:none; opacity:.5; }
      .env-flap, .letter{ transition: none; }
    }
  </style>
</head>

<body>
  <canvas id="fx" aria-hidden="true"></canvas>
  <div class="mist" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>

  <div class="topbar" aria-hidden="true">
    <span class="topdot"></span>
    <span>Love Letter Mode ‚Äî click the seal</span>
  </div>

  <main class="wrap">
    <div class="stage" id="stage">
      <div class="envelope" id="envelope">
        <div class="frame" aria-hidden="true"></div>

        <div class="env-body" aria-hidden="true"></div>
        <div class="env-flap" aria-hidden="true"></div>

        <div class="letter" id="letter">
          <div class="paper">
            <h1 class="calligraphy">Aso ‚ù§Ô∏è Elaf</h1>
            <div class="divider"></div>
            <p class="type" id="typeLine"></p>
            <div class="sig">‚Äî written in starlight ‚ú®</div>

            <div class="mini">
              <button class="btn primary" id="btnBurst" type="button">Sprinkle Love</button>
              <button class="btn" id="btnSound" type="button" aria-pressed="false">Sound: OFF</button>
              <button class="btn" id="btnClose" type="button">Close Letter</button>
            </div>
          </div>
        </div>

        <div class="env-left" aria-hidden="true"></div>
        <div class="env-right" aria-hidden="true"></div>
        <div class="env-front" aria-hidden="true"></div>

        <button class="seal" id="seal" type="button" aria-label="Open love letter">
          <span>üíó</span>
          <small>tap to open</small>
        </button>
      </div>
    </div>
  </main>

  <div class="foot" aria-hidden="true">
    <span class="kbd">H</span> hearts
    <span class="kbd">Click</span> sparkles
  </div>

  <script>
    // =========================
    // Canvas FX (stars + glitter bursts)
    // =========================
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha:true });

    let W=0,H=0,DPR=Math.min(devicePixelRatio||1,2);
    function resize(){
      W = innerWidth; H = innerHeight;
      DPR = Math.min(devicePixelRatio||1,2);
      canvas.width = Math.floor(W*DPR);
      canvas.height = Math.floor(H*DPR);
      canvas.style.width = W+"px";
      canvas.style.height = H+"px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    addEventListener("resize", resize);
    resize();

    const prefersReduced = matchMedia("(prefers-reduced-motion: reduce)").matches;
    const rand = (a,b)=> a + Math.random()*(b-a);

    const stars = Array.from({length: 180}, ()=>({
      x: Math.random()*W,
      y: Math.random()*H,
      r: rand(0.6, 2.0),
      a: rand(0.08, 0.65),
      tw: rand(0.002, 0.012),
      sp: rand(0.03, 0.18),
    }));

    let mx=0,my=0;
    addEventListener("pointermove",(e)=>{
      mx = (e.clientX/W - 0.5)*2;
      my = (e.clientY/H - 0.5)*2;
    });

    const glitter = [];
    function burst(x,y, power=1){
      if (prefersReduced) return;
      const n = Math.floor(24*power);
      for(let i=0;i<n;i++){
        glitter.push({
          x,y,
          vx: (Math.random()-0.5)*4.0*power,
          vy: (Math.random()-0.8)*4.6*power,
          life: 1,
          r: rand(1.0, 2.6),
          t: Math.random(),
        });
      }
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      // stars
      for(const s of stars){
        s.a += (Math.random()<0.5?-1:1)*s.tw;
        s.a = Math.max(0.06, Math.min(0.75, s.a));
        s.x += s.sp;
        if(s.x > W+20) s.x = -20;

        const px = s.x + mx*10;
        const py = s.y + my*7;

        ctx.beginPath();
        ctx.arc(px, py, s.r, 0, Math.PI*2);
        ctx.fillStyle = `rgba(255,255,255,${s.a})`;
        ctx.fill();
      }

      // glitter
      for(let i=glitter.length-1;i>=0;i--){
        const g = glitter[i];
        g.x += g.vx; g.y += g.vy;
        g.vx *= 0.98; g.vy *= 0.98;
        g.life -= 0.02;

        if(g.life <= 0){ glitter.splice(i,1); continue; }

        const a = g.life * 0.75;
        const grad = ctx.createRadialGradient(g.x,g.y,0,g.x,g.y,14);
        grad.addColorStop(0, `rgba(255,46,122,${a})`);
        grad.addColorStop(0.55, `rgba(34,211,238,${a*0.55})`);
        grad.addColorStop(1, "rgba(0,0,0,0)");

        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(g.x, g.y, 10 + g.r*2, 0, Math.PI*2);
        ctx.fill();
      }

      requestAnimationFrame(draw);
    }
    draw();

    // =========================
    // Love letter open/close + typewriter
    // =========================
    const env = document.getElementById("envelope");
    const seal = document.getElementById("seal");
    const btnClose = document.getElementById("btnClose");
    const btnBurst = document.getElementById("btnBurst");
    const typeLine = document.getElementById("typeLine");

    const lines = [
      "In every universe‚Ä¶",
      "Aso ‚ù§Ô∏è Elaf.",
      "A love letter sealed with starlight."
    ];

    let typing = false;
    let open = false;

    function setRipple(x,y){
      const r = document.createElement("div");
      r.className = "ripple";
      r.style.left = x + "px";
      r.style.top  = y + "px";
      document.body.appendChild(r);
      r.addEventListener("animationend", ()=> r.remove());
    }

    function typewriter(){
      if (typing) return;
      typing = true;
      typeLine.innerHTML = ""; // reset
      const cursor = document.createElement("span");
      cursor.className = "cursor";

      let i=0, j=0;
      const speed = prefersReduced ? 0 : 22;

      function step(){
        if(!open){ typing = false; return; }

        const current = lines[i];
        if(j < current.length){
          typeLine.textContent += current[j++];
          typeLine.appendChild(cursor);
          if(speed === 0){ j = current.length; }
          setTimeout(step, speed);
          return;
        }

        // next line
        if(i < lines.length - 1){
          typeLine.textContent += "\n";
          j = 0;
          i++;
          setTimeout(step, prefersReduced ? 0 : 260);
          return;
        }

        // done
        typeLine.appendChild(cursor);
        typing = false;
      }

      // preserve line breaks visually
      typeLine.style.whiteSpace = "pre-line";
      step();
    }

    function openLetter(){
      open = true;
      env.classList.add("open");
      if (!prefersReduced) {
        const r = seal.getBoundingClientRect();
        const x = r.left + r.width/2;
        const y = r.top + r.height/2;
        setRipple(x,y);
        burst(x,y,1.25);
        heartConfetti(x,y,1.1);
      }
      typewriter();
      playChord();
    }

    function closeLetter(){
      open = false;
      env.classList.remove("open");
      typeLine.textContent = "";
    }

    // =========================
    // Parallax tilt (smart, subtle)
    // =========================
    const stage = document.getElementById("stage");
    let lastMove = 0;
    addEventListener("pointermove", (e)=>{
      if(prefersReduced) return;
      const now = performance.now();
      if(now - lastMove < 14) return;
      lastMove = now;

      const r = stage.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const dx = (e.clientX - cx) / r.width;
      const dy = (e.clientY - cy) / r.height;

      const max = 8;
      stage.style.transform = `rotateX(${(-dy*max).toFixed(2)}deg) rotateY(${(dx*max).toFixed(2)}deg)`;
    });
    addEventListener("pointerleave", ()=> stage.style.transform = "rotateX(0deg) rotateY(0deg)");
    addEventListener("blur", ()=> stage.style.transform = "rotateX(0deg) rotateY(0deg)");

    // =========================
    // Heart confetti (no external libs)
    // =========================
    const conf = [];
    const heartChars = ["üíó","üíñ","üíû","üíò","‚ù§Ô∏è","‚ú®"];

    function heartConfetti(x,y,power=1){
      if(prefersReduced) return;
      const n = Math.floor(14 * power);
      for(let i=0;i<n;i++){
        conf.push({
          x,y,
          vx:(Math.random()-0.5)*4.8*power,
          vy:(Math.random()-1.0)*5.8*power,
          rot: rand(-1.2, 1.2),
          vr: rand(-0.10, 0.10),
          life: 1,
          s: rand(14, 24),
          ch: heartChars[Math.floor(Math.random()*heartChars.length)]
        });
      }
    }

    function drawEmojiConfetti(){
      if(prefersReduced) return;
      // draw on top of canvas using 2D text
      ctx.save();
      for(let i=conf.length-1;i>=0;i--){
        const c = conf[i];
        c.x += c.vx; c.y += c.vy;
        c.vx *= 0.985; c.vy *= 0.985;
        c.vy += 0.06; // gravity
        c.rot += c.vr;
        c.life -= 0.018;

        if(c.life <= 0){ conf.splice(i,1); continue; }

        ctx.globalAlpha = Math.max(0, c.life);
        ctx.font = `${c.s}px Inter, system-ui, sans-serif`;
        ctx.translate(c.x, c.y);
        ctx.rotate(c.rot);
        ctx.fillText(c.ch, -c.s/2, c.s/2);
        ctx.setTransform(DPR,0,0,DPR,0,0);
      }
      ctx.restore();
      requestAnimationFrame(drawEmojiConfetti);
    }
    drawEmojiConfetti();

    // =========================
    // Click actions
    // =========================
    seal.addEventListener("click", ()=>{
      if(open) closeLetter();
      else openLetter();
    });

    btnClose.addEventListener("click", closeLetter);

    btnBurst.addEventListener("click", ()=>{
      const r = env.getBoundingClientRect();
      const x = r.left + r.width/2;
      const y = r.top + r.height/2 - 40;
      setRipple(x,y);
      burst(x,y,1.35);
      heartConfetti(x,y,1.25);
      playChord();
    });

    addEventListener("pointerdown",(e)=>{
      const tag = (e.target?.tagName || "").toLowerCase();
      if(tag === "button") return;
      setRipple(e.clientX, e.clientY);
      burst(e.clientX, e.clientY, 1.0);
      heartConfetti(e.clientX, e.clientY, 0.95);
    });

    addEventListener("keydown",(e)=>{
      if(e.key.toLowerCase() === "h"){
        const x = rand(80, innerWidth-80);
        const y = rand(120, innerHeight-200);
        setRipple(x,y);
        burst(x,y,1.0);
        heartConfetti(x,y,1.0);
        playChord();
      }
      if(e.key === "Escape" && open) closeLetter();
    });

    // =========================
    // Cute sound chord (optional, user-toggle)
    // =========================
    const btnSound = document.getElementById("btnSound");
    let soundOn = false;
    let audioCtx = null;

    btnSound.addEventListener("click", ()=>{
      soundOn = !soundOn;
      btnSound.textContent = soundOn ? "Sound: ON" : "Sound: OFF";
      btnSound.setAttribute("aria-pressed", soundOn ? "true" : "false");
      if(soundOn && !audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    });

    function playChord(){
      if(!soundOn) return;
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      const now = audioCtx.currentTime;
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(0.22, now + 0.03);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.55);
      gain.connect(audioCtx.destination);

      const freqs = [440, 554.37, 659.25]; // A major-ish
      freqs.forEach((f, idx)=>{
        const o = audioCtx.createOscillator();
        o.type = idx === 0 ? "triangle" : "sine";
        o.frequency.setValueAtTime(f, now);
        o.connect(gain);
        o.start(now);
        o.stop(now + 0.58);
      });
    }

    // Auto-open gentle hint animation: tiny burst near seal
    setTimeout(()=>{
      const r = seal.getBoundingClientRect();
      const x = r.left + r.width/2;
      const y = r.top + r.height/2;
      burst(x,y,0.8);
      heartConfetti(x,y,0.7);
    }, 650);
  </script>
</body>
</html>
